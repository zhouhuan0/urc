<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.yks.urc.mapper.IDataRuleSysMapper">
    <resultMap id="BaseResultMap" type="com.yks.urc.entity.DataRuleSysDO">
        <id column="id" jdbcType="BIGINT" property="id"/>
        <result column="data_rule_sys_id" jdbcType="BIGINT" property="dataRuleSysId"/>
        <result column="data_rule_id" jdbcType="BIGINT" property="dataRuleId"/>
        <result column="sys_key" jdbcType="CHAR" property="sysKey"/>
        <result column="create_time" jdbcType="TIMESTAMP" property="createTime"/>
        <result column="create_by" jdbcType="VARCHAR" property="createBy"/>
        <result column="modified_time" jdbcType="TIMESTAMP" property="modifiedTime"/>
        <result column="modified_by" jdbcType="VARCHAR" property="modifiedBy"/>
    </resultMap>

    <resultMap id="FullBaseResultMap" type="com.yks.urc.entity.DataRuleSysDO">
        <id column="id" jdbcType="BIGINT" property="id"/>
        <result column="data_rule_sys_id" jdbcType="BIGINT" property="dataRuleSysId"/>
        <result column="data_rule_id" jdbcType="BIGINT" property="dataRuleId"/>
        <result column="sys_key" jdbcType="CHAR" property="sysKey"/>
        <result column="create_time" jdbcType="TIMESTAMP" property="createTime"/>
        <result column="create_by" jdbcType="VARCHAR" property="createBy"/>
        <result column="modified_time" jdbcType="TIMESTAMP" property="modifiedTime"/>
        <result column="modified_by" jdbcType="VARCHAR" property="modifiedBy"/>
        <association property="expressionDO" javaType="com.yks.urc.entity.ExpressionDO">
            <result column="data_rule_sys_id" jdbcType="BIGINT" property="dataRuleSysId"/>
            <result column="expression_id" jdbcType="BIGINT" property="expressionId"/>
            <result column="is_and" jdbcType="TINYINT" property="isAnd"/>
            <result column="field_code" jdbcType="VARCHAR" property="filedCode"/>
            <result column="entity_code" jdbcType="VARCHAR" property="entityCode"/>
            <result column="oper" jdbcType="VARCHAR" property="oper"/>
            <result column="parent_expression_id" jdbcType="BIGINT" property="parentExpressionId"/>
            <result column="oper_values" jdbcType="LONGVARCHAR" property="operValues"/>
        </association>
        <collection property="dataRuleColDOS" ofType="com.yks.urc.entity.DataRuleColDO">
            <!--   <id column="id" jdbcType="BIGINT" property="id"/>-->
            <result column="data_rule_sys_id" jdbcType="BIGINT" property="dataRuleSysId"/>
            <result column="col_json" jdbcType="LONGVARCHAR" property="colJson"/>
            <result column="entity_code" jdbcType="VARCHAR" property="entityCode"/>
        </collection>
    </resultMap>


    <!-- <resultMap id="queryForListMap" type="com.yks.urc.entity.DataRuleSysDO">
         <result column="sys_key" jdbcType="CHAR" property="sysKey"/>
         &lt;!&ndash;数据权限sys-urcsql关系&ndash;&gt;
         <collection property="urcSqlDOList" ofType="com.yks.urc.entity.UrcSqlDO">
             <result column="sql_id" jdbcType="TINYINT" property="sqlId"/>
             <result column="entity_code" jdbcType="VARCHAR" property="entityCode"/>
             <result column="hidden_fields" jdbcType="VARCHAR" property="hiddenFields"/>
             &lt;!&ndash;urcSql-urc_expression 关系&ndash;&gt;
             <collection property="expressionDOS" ofType="com.yks.urc.entity.ExpressionDO">
                 <id column="id" jdbcType="TINYINT" property="id"/>
                 <result column="is_and" jdbcType="INTEGER" property="isAnd"/>
                 <result column="field_code" jdbcType="VARCHAR" property="fieldCode"/>
                 <result column="entity_code" jdbcType="VARCHAR" property="entityCode"/>
             </collection>
         </collection>

     </resultMap>-->

    <sql id="Base_Column_List">
    id, data_rule_sys_id, data_rule_id, sys_key, create_time, create_by, modified_time, modified_by
  </sql>
    <!--新增-->
    <insert id="insert" parameterType="com.yks.urc.entity.DataRuleSysDO">
        insert into urc_data_rule_sys ( data_rule_id, sys_key,
        create_time, create_by, modified_time, modified_by)
        values ( #{dataRuleId,jdbcType=BIGINT}, #{sysKey,jdbcType=CHAR},
        #{createTime,jdbcType=TIMESTAMP}, #{createBy,jdbcType=VARCHAR},
        #{modifiedTime,jdbcType=TIMESTAMP},#{modifiedBy,jdbcType=VARCHAR})
    </insert>

    <!--批量新增-->
    <insert id="insertBatch" parameterType="java.util.List">
        insert into urc_data_rule_sys ( data_rule_sys_id,data_rule_id, sys_key,create_time, create_by, modified_time,
        modified_by)
        values
        <foreach collection="list" index="index" item="item" separator=",">
            ( #{item.dataRuleSysId,jdbcType=BIGINT},#{item.dataRuleId,jdbcType=BIGINT}, #{item.sysKey,jdbcType=CHAR},
            #{item.createTime,jdbcType=TIMESTAMP}, #{item.createBy,jdbcType=VARCHAR},
            #{item.modifiedTime,jdbcType=TIMESTAMP},#{item.modifiedBy,jdbcType=VARCHAR})
        </foreach>
    </insert>
    <!--根据dataRuleIds 获取数据权限Sys  包括对应的 行权限  列权限-->
    <select id="getDataRuleSysDatas" parameterType="java.lang.Long" resultMap="FullBaseResultMap">
        select
        us.id,us.data_rule_sys_id,us.data_rule_id,us.sys_key,us.create_time,us.create_by,us.modified_time,us.modified_by,
        ue.data_rule_sys_id,ue.expression_id,ue.is_and,ue.field_code,ue.entity_code,ue.oper,ue.parent_expression_id,ue.oper_values,
        ud.id,ud.data_rule_sys_id,ud.col_json,ud.entity_code
        from urc_data_rule_sys us
        left join urc_expression ue on us.data_rule_sys_id = ue.data_rule_sys_id
        left join urc_data_rule_col ud on us.data_rule_sys_id = ud.data_rule_sys_id
        where us.data_rule_id = #{dataRuleId,jdbcType=BIGINT}
        <!-- where us.data_rule_id in
         <foreach collection="list" item="dataRuleId" open="(" separator="," close=")">
             #{dataRuleId}
         </foreach>-->
    </select>

    <!--根据dataRuleId获取数据权限sys-->
    <select id="listByDataRuleId" parameterType="java.lang.Long" resultMap="FullBaseResultMap">
       /*  select
         ud.sys_key,us.sql_id,us.entity_code,us.hidden_fields,ue.field_code,ue.entity_code
         from urc_data_rule_sys ud
         LEFT JOIN urc_sql us ON ud.data_rule_sys_id = us.data_rule_sys_id
         LEFT JOIN urc_expression ue ON us.sql_id = ue.sql_id
         where ud.data_rule_id = #{dataRuleId,jdbcType=BIGINT}*/
     </select>
    <!-- <select id="listByDataRuleId" parameterType="java.lang.Long" resultMap="BaseResultMap">
       select
       <include refid="Base_Column_List" />
       from urc_data_rule_sys
       where data_rule_id = #{id,jdbcType=BIGINT}
     </select>-->

</mapper>